/**
 * skylark-spa - An Elegant  HTML5 Single Page Application Framework.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.1
 * @link www.skylarkjs.org
 * @license MIT
 */
!function(t,n){function r(t,n){if("."!==t[0])return t;var r=n.split("/"),e=t.split("/");r.pop();for(var i=0;i<e.length;i++)"."!=e[i]&&(".."==e[i]?r.pop():r.push(e[i]));return r.join("/")}var e=n.define,i=n.require,o="function"==typeof e&&e.amd,a=!o&&"undefined"!=typeof exports;if(!o&&!e){var s={};e=n.define=function(t,n,e){"function"==typeof e?(s[t]={factory:e,deps:n.map(function(n){return r(n,t)}),exports:null},i(t)):resolved[t]=e},i=n.require=function(t){if(!s.hasOwnProperty(t))throw new Error("Module "+t+" has not been defined");var n=s[t];if(!n.exports){var r=[];n.deps.forEach(function(t){r.push(i(t))}),n.exports=n.factory.apply(window,r)}return n.exports}}if(!e)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(t(e,i),o)e(["skylark-spa"],function(t){return t});else{var u=i("skylark-spa/main");a?exports=u:n.skylarkjs=u}}(function(t,n){t("skylark-spa/spa",["skylark-langx/skylark","skylark-langx/langx","skylark-router/router"],function(t,r,e){function i(t,n){var e=new CustomEvent(t,n);return r.safeMixin(e,n)}var o,a=r.Deferred,s=e.Route=e.Route.inherit({klassName:"SpaRoute",init:function(t,n){this.overrided(t,n),this.content=n.content,this.data=n.data;var e=this;["preparing","rendering","rendered"].forEach(function(t){r.isFunction(n[t])&&e.on(t,n[t])})},_entering:function(t){return this._prepared?this:this.prepare()},getConfigData:function(t){return t?this.data[t]:this.data},prepare:function(){var t=new a,r=this._setting,o=r.controller,s=this.controller,u=this;r.content,r.contentPath;return o&&!s?n([o.type],function(n){s=u.controller=new n(o),t.resolve()}):t.resolve(),t.then(function(){var t=i("preparing",{route:u,result:!0});return u.trigger(t),a.when(t.result).then(function(){e.trigger(i("prepared",{route:u})),u._prepared=!0})})},render:function(t){var n=i("rendering",{route:this,context:t,content:this.content});return this.trigger(n),n.content},trigger:function(t){var n=this.controller;return n?n.perform(t):this.overrided(t)}}),u=r.Evented.inherit({klassName:"SpaRouteController",init:function(t,n){n=n||{},this.content=n.content,this.data=n.data},getConfigData:function(t){return t?this.data[t]:this.data},perform:function(t){var n=t.type;if(this[n])return this[n].call(this,t)}}),p=r.Evented.inherit({klassName:"SpaPage",init:function(t){t=r.mixin({routeViewer:"body"},t),this._params=t,this._rvc=document.querySelector(t.routeViewer),this._router=e,e.on("routing",r.proxy(this,"refresh"))},prepare:function(){},refresh:function(){var t=e.current(),n=(e.previous(),t.route.render(t));r.isString(n)?this._rvc.innerHTML=n:(this._rvc.innerHTML="",this._rvc.appendChild(n))}}),l=r.Evented.inherit({klassName:"SpaPlugin",init:function(t,n){this.name=t,this._setting=n},prepare:function(){var t=new a,o=this._setting,s=o.controller,u=this.controller,p=this;return s&&!u?n([s.type],function(n){u=p.controller=new n(s),e.on(o.hookers,{plugin:p},r.proxy(u.perform,u)),t.resolve()}):(r.each(o.hookers,function(t,n){e.on(t,{plugin:p},n)}),t.resolve()),t.then(function(){var t=i("preparing",{result:!0});return p.trigger(t),a.when(t.result).then(function(){p._prepared=!0})})}}),c=r.Evented.inherit({klassName:"SpaPluginController",init:function(t){this.plugin=t},perform:function(t){var n=t.type;if(this[n])return this[n].call(this,t)}}),h=r.Evented.inherit({klassName:"SpaApplication",init:function(t){if(o)return o;var n=this._plugins={};t=this._config=r.mixin({plugins:{}},t,!0),r.each(t.plugins,function(t,r){n[t]=new l(t,r)}),e.routes(t.routes),this._router=e,this._page=new f.Page(t.page),document.title=t.title;var i=t.baseUrl;void 0===i&&(i=t.baseUrl=new r.URL(document.baseURI).pathname),e.baseUrl(i),t.homePath&&e.homePath(t.homePath),o=this},getConfig:function(t){return t?this._config[t]:this._config},go:function(t){return e.go(t),this},page:function(){return this._page},prepare:function(){var t=this,n=r.map(e.routes(),function(t,n){if(t.lazy===!1)return t.prepare()}),o=r.map(this._plugins,function(t,n){return t.prepare()});return a.all(n.concat(o)).then(function(){return e.trigger(i("starting",{spa:t}))})},run:function(){this._router.start()}}),f=function(t){return o||(window[t.name||"app"]=o=new f.Application(t)),o};return r.mixin(f,{Application:h,Page:p,Plugin:l,PluginController:c,Route:s,RouteController:u}),t.spa=f}),t("skylark-spa/main",["skylark-langx/skylark","./spa"],function(t){return t}),t("skylark-spa",["skylark-spa/main"],function(t){return t})},this);
//# sourceMappingURL=sourcemaps/skylark-spa.js.map
